---
- name: Detect WSL
  ansible.builtin.shell: |
    if [[ $(cat /proc/version | grep microsoft.*WSL) ]]; then
      echo true
    else
      echo false
    fi
  register: ansible_host_environment_is_wsl
  args:
    executable: /bin/bash
  ignore_errors: true
  changed_when: false

- name: Register WSL State fact
  ansible.builtin.set_fact:
    ansible_host_environment_is_wsl: "{{ ansible_host_environment_is_wsl.stdout }}"

- name: Show WSL State
  ansible.builtin.debug:
    msg: "WSL State: '{{ ansible_host_environment_is_wsl }}'"

# whoami wsl version
- name: Detect Windows Current User
  ansible.builtin.shell:
    cmd: $env:UserName
  register: windows_user
  changed_when: false
  failed_when: windows_user.rc != 0
  args:
    executable: powershell.exe

- name: Register Windows Current User
  ansible.builtin.set_fact:
    wsl_host_user: "{{ windows_user.stdout }}"
  when: host_user is not defined

- name: DEBUG
  ansible.builtin.debug:
    msg: "wsl_host_user: {{ wsl_host_user }}"
